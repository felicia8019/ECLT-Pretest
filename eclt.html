<!-- START OF FILE -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ECLT Quiz App</title>
  <style>
    body { font-family: system-ui, sans-serif; background: #0b1220; color: #e8ecf1; margin: 0; padding: 20px; }
    .card { background: #121a2b; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 0 10px rgba(0,0,0,0.3); }
    .hide { display: none; }
    .btn { padding: 10px 14px; margin: 5px; border: none; border-radius: 8px; cursor: pointer; background: #4ba3ff; color: white; }
    .btn:hover { background: #5bb3ff; }
    .opt { margin: 8px 0; padding: 10px; background: #1c2a3f; border-radius: 8px; cursor: pointer; }
    .opt.correct { background: #27c27033; }
    .tag { display: inline-block; background: #1c2a3f; padding: 4px 8px; border-radius: 8px; margin-right: 8px; font-size: 0.9em; }
  </style>
</head>
<body>

<!-- Daily Code Login -->
<div id="screen-login" class="card">
  <h2>Enter Daily Access Code</h2>
  <input id="login-code" type="text" placeholder="Enter code" />
  <button class="btn" onclick="validateDailyCode()">Continue</button>
</div>

<!-- Role Selection -->
<div id="screen-role" class="card hide">
  <h2>Select Role</h2>
  <button class="btn" onclick="setRole('user')">User (Take Test)</button>
  <button class="btn" onclick="setRole('recruiter')">Recruiter (Manage)</button>
</div>

<!-- Test Setup -->
<div id="screen-setup" class="card hide">
  <h2>Select Test Mode</h2>
  <button class="btn" onclick="startTest('short')">Short (20 Q)</button>
  <button class="btn" onclick="startTest('full')">Full (40 Q)</button>
</div>

<!-- Quiz Screen -->
<div id="screen-quiz" class="card hide">
  <div>
    <span class="tag" id="tag-mode">Mode</span>
    <span class="tag" id="tag-counter">Q 1 / 20</span>
    <span class="tag" id="tag-type">Section</span>
  </div>
  <h3 id="prompt">Prompt</h3>
  <div id="choices"></div>
  <button class="btn" onclick="prev()">Prev</button>
  <button class="btn" onclick="next()">Next</button>
  <button class="btn" onclick="submit()">Submit</button>
</div>

<!-- Results -->
<div id="screen-results" class="card hide">
  <h2>Results</h2>
  <p><strong>Score:</strong> <span id="score-pct">—</span></p>
  <p><strong>Raw:</strong> <span id="score-raw">—</span></p>
  <p><strong>Breakdown:</strong> <span id="breakdown">—</span></p>
</div>

<script>
// Daily Code Generator
function getObscuredDailyCode() {
  const today = new Date();
  const yyyy = today.getFullYear();
  const mm = String(today.getMonth() + 1).padStart(2, '0');
  const dd = String(today.getDate()).padStart(2, '0');
  const raw = `ECLT2025-${yyyy}${mm}${dd}`;
  let code = '';
  for (let i = raw.length - 1; i >= 0; i--) {
    code += String.fromCharCode(raw.charCodeAt(i) + 3);
  }
  return code.slice(0, 12);
}

function validateDailyCode() {
  const input = document.querySelector('#login-code').value.trim();
  const validCode = getObscuredDailyCode();
  if (input === validCode) {
    document.querySelector('#screen-login').classList.add('hide');
    document.querySelector('#screen-role').classList.remove('hide');
  } else {
    alert("Invalid code. Please try again.");
  }
}

// App State
const $ = s => document.querySelector(s);
const state = {
  role: 'user',
  mode: 'short',
  total: 20,
  idx: 0,
  order: [],
  answers: {},
  targets: { structure: 8, vocab: 6, reading: 6 }
};

// Question Bank (insert full QUESTION_BANK array from your uploaded file here)
const QUESTION_BANK = [/* your full question array goes here */];

function setRole(role) {
  state.role = role;
  $('#screen-role').classList.add('hide');
  $('#screen-setup').classList.remove('hide');
}

function startTest(mode) {
  state.mode = mode;
  state.total = mode === 'short' ? 20 : 40;
  state.targets = mode === 'short'
    ? { structure: 8, vocab: 6, reading: 6 }
    : { structure: 16, vocab: 12, reading: 12 };
  state.order = buildBalancedOrder();
  state.answers = {};
  state.idx = 0;
  $('#tag-mode').textContent = mode.charAt(0).toUpperCase() + mode.slice(1);
  $('#screen-setup').classList.add('hide');
  $('#screen-quiz').classList.remove('hide');
  renderQuestion();
}

function buildBalancedOrder() {
  const byType = { structure: [], vocab: [], reading: [] };
  QUESTION_BANK.forEach((q, i) => byType[q.type]?.push(i));
  Object.values(byType).forEach(arr => arr.sort(() => Math.random() - 0.5));
  const pick = [];
  for (const t of ['structure', 'vocab', 'reading']) {
    const need = state.targets[t];
    const src = byType[t];
    for (let i = 0; i < need && i < src.length; i++) pick.push(src[i]);
  }
  if (pick.length < state.total) {
    const rest = QUESTION_BANK.map((_, i) => i).filter(i => !pick.includes(i));
    pick.push(...rest.slice(0, state.total - pick.length));
  }
  return pick.slice(0, state.total);
}

function renderQuestion() {
  const q = QUESTION_BANK[state.order[state.idx]];
  $('#prompt').textContent = q.prompt;
  $('#tag-counter').textContent = `Q ${state.idx + 1} / ${state.total}`;
  $('#tag-type').textContent = q.type.charAt(0).toUpperCase() + q.type.slice(1);
  const container = $('#choices');
  container.innerHTML = '';
  q.choices.forEach((choice, i) => {
    const div = document.createElement('div');
    div.className = 'opt';
    if (state.answers[q.id] === i) div.classList.add('correct');
    div.innerHTML = `<input type="radio" name="choice" value="${i}"> ${choice}`;
    div.onclick = () => {
      state.answers[q.id] = i;
      renderQuestion();
    };
    container.appendChild(div);
  });
}

function next() {
  if (state.idx < state.total - 1) {
    state.idx++;
    renderQuestion();
  }
}

function prev() {
  if (state.idx > 0) {
    state.idx--;
    renderQuestion();
  }
}

function submit() {
  let correct = 0;
  let breakdown = { structure: 0, vocab: 0, reading: 0 };
  state.order.forEach(i => {
    const q = QUESTION_BANK[i];
    const ans = state.answers[q.id];
    if (ans ===