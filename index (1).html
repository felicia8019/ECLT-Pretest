<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Access - Recruiter / Applicant</title>
<style>
  :root{--accent:#0b63ff;--muted:#666;}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:0;background:#f6f8fb;color:#111}
  .wrap{max-width:960px;margin:28px auto;padding:20px;background:#fff;border-radius:10px;box-shadow:0 6px 20px rgba(12,20,40,.06)}
  h1{margin:0 0 18px;font-size:20px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:18px}
  label{display:block;margin:8px 0 6px;font-weight:600}
  input[type="text"], input[type="password"]{width:100%;padding:10px;border-radius:6px;border:1px solid #ddd;font-size:14px}
  button{padding:10px 12px;border-radius:8px;border:0;background:var(--accent);color:#fff;font-weight:600;cursor:pointer}
  button.secondary{background:#e8eefc;color:var(--accent);border:1px solid rgba(11,99,255,0.12)}
  .muted{color:var(--muted);font-size:13px}
  .controls{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap}
  .hidden{display:none}
  .box{padding:12px;border-radius:8px;border:1px dashed #eee;background:#fbfdff}
  .app-screen{padding:18px}
  .small{font-size:13px}
  footer{margin-top:16px;color:#666;font-size:13px}
  .notice{margin-top:10px;padding:10px;border-radius:8px;background:#fff6e6;color:#7a5200;border:1px solid #ffe7c7}
  @media (max-width:760px){ .grid{grid-template-columns:1fr} }
</style>
</head>
<body>
  <div class="wrap">
    <h1>Welcome — Recruiter & Applicant Access</h1>
    <p class="muted">Use the left panel for recruiter actions. Applicants use the right panel to enter their daily code.</p>

    <div class="grid" id="initial-grid">
      <div class="box" id="recruiter-panel">
        <strong>Recruiter Login</strong>
        <p class="muted small">Log in to generate or view today's applicant code, or bypass to launch the app.</p>

        <label for="recruiter-pass">Recruiter password</label>
        <input id="recruiter-pass" type="password" placeholder="Enter recruiter password" autocomplete="off">

        <div class="controls" style="margin-top:10px">
          <button id="btn-recruiter-login">Login</button>
          <button id="btn-recruiter-logout" class="secondary hidden">Logout</button>
        </div>

        <div id="recruiter-controls" class="hidden" style="margin-top:12px">
          <div class="small muted">Recruiter controls</div>
          <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
            <button id="btn-generate">Generate Today's Code</button>
            <button id="btn-copy" class="secondary">Copy Code</button>
            <button id="btn-bypass" class="secondary">Bypass & Launch App</button>
            <button id="btn-show-code" class="secondary">Show Current Expected Code</button>
          </div>

          <div id="recruiter-code-box" class="box hidden" style="margin-top:10px;word-break:break-all">
            <div><strong>Today's code:</strong></div>
            <div id="display-code" style="font-family:monospace;margin-top:6px"></div>
          </div>
        </div>
      </div>

      <div class="box" id="applicant-panel">
        <strong>Applicant Login</strong>
        <p class="muted small">Applicants enter the daily code provided by staff (or generated by recruiter).</p>

        <label for="daily-code">Daily access code</label>
        <input id="daily-code" type="text" placeholder="Enter daily code (case-sensitive)" autocomplete="off">

        <div class="controls" style="margin-top:10px">
          <button id="btn-continue">Continue</button>
          <button id="btn-fill-from-recruiter" class="secondary">Fill from recruiter (if shown)</button>
        </div>

        <div id="applicant-message" style="margin-top:8px" class="muted small"></div>
      </div>
    </div>

    <div id="app-screen" class="hidden app-screen">
      <h2>Application — Launched</h2>
      <p class="muted">You are now inside the app. (Replace this area with your actual app UI.)</p>
      <div style="margin-top:12px">
        <button id="btn-return" class="secondary">Return to Login</button>
      </div>
    </div>

    <div class="notice">
      <strong>Security note:</strong> This implementation is client-side only. Recruiter password and the daily-code generator live in browser JS and can be inspected. For production security, implement server-side authentication and server-generated daily codes.
    </div>

    <footer>
      Quick test: change <code>RECRUITER_PASSWORD</code> near the top of the script. Use “Generate Today’s Code” to see the exact string the app expects.
    </footer>
  </div>

<script>
/*
  Single-file client-side implementation:
  - Recruiter & applicant login on one page.
  - Daily code algorithm UNCHANGED:
      raw = \`ECLT\${yyyy}-\${yyyymmdd}\`
      reverse, add +3 to each char code, take first 12 chars
  - For production, move auth & code generation server-side.
*/
const RECRUITER_PASSWORD = 'recruiter123'; // <-- change this to your desired recruiter password
const DEV_SHOW_GENERATOR_STRATEGY = false; // set true during dev to console.log extra info

// UI refs
const $ = id => document.getElementById(id);
const recruiterPass = $('recruiter-pass');
const btnRecruiterLogin = $('btn-recruiter-login');
const btnRecruiterLogout = $('btn-recruiter-logout');
const recruiterControls = $('recruiter-controls');
const recruiterCodeBox = $('recruiter-code-box');
const displayCode = $('display-code');
const btnGenerate = $('btn-generate');
const btnCopy = $('btn-copy');
const btnBypass = $('btn-bypass');
const btnShowCode = $('btn-show-code');

const dailyCodeInput = $('daily-code');
const btnContinue = $('btn-continue');
const btnFillFromRecruiter = $('btn-fill-from-recruiter');
const applicantMessage = $('applicant-message');

const appScreen = $('app-screen');
const initialGrid = $('initial-grid');
const btnReturn = $('btn-return');

let state = {
  recruiterLoggedIn: false,
  lastGeneratedCode: null,
  appLaunchedBy: null // 'applicant' or 'recruiter-bypass'
};

// --- daily code generator (UNCHANGED algorithm) ---
function getObscuredDailyCode(forDate = new Date()) {
  // Build raw: "ECLT" + yyyy + "-" + yyyymmdd
  const yyyy = forDate.getFullYear();
  const mm = String(forDate.getMonth() + 1).padStart(2, '0');
  const dd = String(forDate.getDate()).padStart(2, '0');
  const yyyymmdd = \`\${yyyy}\${mm}\${dd}\();
  const raw = \`ECLT\${yyyy}-\${yyyymmdd}\`; // e.g., "ECLT2025-20251018"

  // Obscure: reverse string and add 3 to charcode, then take first 12 chars.
  const rev = raw.split('').reverse().map(ch => String.fromCharCode(ch.charCodeAt(0) + 3)).join('');
  const out = rev.slice(0, 12);
  if (DEV_SHOW_GENERATOR_STRATEGY) console.log({raw, rev, out});
  return out;
}

// --- UI behaviors ---
function setRecruiterLoggedIn(on) {
  state.recruiterLoggedIn = on;
  recruiterControls.classList.toggle('hidden', !on);
  btnRecruiterLogout.classList.toggle('hidden', !on);
  btnRecruiterLogin.classList.toggle('hidden', on);
  if (!on) {
    recruiterCodeBox.classList.add('hidden');
    displayCode.textContent = '';
    state.lastGeneratedCode = null;
  }
}

btnRecruiterLogin.addEventListener('click', () => {
  const provided = recruiterPass.value || '';
  if (provided === RECRUITER_PASSWORD) {
    setRecruiterLoggedIn(true);
    recruiterPass.value = '';
    applicantMessage.textContent = 'Recruiter logged in.';
  } else {
    alert('Incorrect recruiter password.');
  }
});

btnRecruiterLogout.addEventListener('click', () => {
  setRecruiterLoggedIn(false);
  applicantMessage.textContent = '';
});

btnGenerate.addEventListener('click', () => {
  const code = getObscuredDailyCode(new Date());
  state.lastGeneratedCode = code;
  displayCode.textContent = code;
  recruiterCodeBox.classList.remove('hidden');
  recruiterCodeBox.style.border = '1px solid #d0e3ff';
});

btnCopy.addEventListener('click', async () => {
  const toCopy = state.lastGeneratedCode || getObscuredDailyCode(new Date());
  try {
    await navigator.clipboard.writeText(toCopy);
    alert('Code copied to clipboard.');
  } catch (e) {
    const ta = document.createElement('textarea');
    ta.value = toCopy; document.body.appendChild(ta); ta.select();
    try { document.execCommand('copy'); alert('Code copied (fallback).'); } catch(e2) { alert('Copy failed — manually select and copy: ' + toCopy); }
    ta.remove();
  }
});

btnShowCode.addEventListener('click', () => {
  const code = getObscuredDailyCode(new Date());
  displayCode.textContent = code;
  recruiterCodeBox.classList.remove('hidden');
  state.lastGeneratedCode = code;
});

btnBypass.addEventListener('click', () => {
  if (!state.recruiterLoggedIn) { alert('Recruiter must be logged in to bypass.'); return; }
  launchApp('recruiter-bypass');
});

// Applicant actions
btnContinue.addEventListener('click', () => {
  const provided = (dailyCodeInput.value || '').trim();
  if (!provided) { applicantMessage.textContent = 'Please type the daily code.'; return; }
  const expected = getObscuredDailyCode(new Date());
  if (provided === expected) {
    launchApp('applicant');
  } else {
    applicantMessage.textContent = 'Invalid code. Check with recruiter.';
  }
});

btnFillFromRecruiter.addEventListener('click', () => {
  const candidate = state.lastGeneratedCode || displayCode.textContent || '';
  if (!candidate) {
    applicantMessage.textContent = 'No recruiter code available. Ask recruiter to "Generate Today\'s Code".';
    return;
  }
  dailyCodeInput.value = candidate;
  applicantMessage.textContent = 'Filled with recruiter-provided code.';
});

// Launch / return
function launchApp(by) {
  state.appLaunchedBy = by;
  initialGrid.classList.add('hidden');
  appScreen.classList.remove('hidden');
  applicantMessage.textContent = '';
  console.log('App launched by:', by);
}

btnReturn.addEventListener('click', () => {
  appScreen.classList.add('hidden');
  initialGrid.classList.remove('hidden');
  setRecruiterLoggedIn(false);
  dailyCodeInput.value = '';
  applicantMessage.textContent = '';
});

// Convenience: Enter key submits
[dailyCodeInput, recruiterPass].forEach(el => {
  el.addEventListener('keydown', e => {
    if (e.key === 'Enter') {
      if (el === recruiterPass) btnRecruiterLogin.click();
      if (el === dailyCodeInput) btnContinue.click();
    }
  });
});

// Expose generator for console testing
window.getObscuredDailyCode = getObscuredDailyCode;
if (DEV_SHOW_GENERATOR_STRATEGY) console.log('DEV: daily code function exposed as getObscuredDailyCode()');
</script>
</body>
</html>
